<!doctype html>
<html lang="en">
<head style="min-width: 150px">
    <meta charset="UTF-8">
    <meta name="description" content="A layout example with a side menu that hides on mobile, just like the Pure website.">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Ksher Refund Query API</title>

{#    <link rel="stylesheet" href="https://unpkg.com/purecss@1.0.1/build/pure-min.css" integrity="sha384-" crossorigin="anonymous">#}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/pure-min.css') }}"
        integrity="sha384-oAOxQR6DkCoMliIh8yFnu25d7Eq/PHS21PClpwjOTeU2jRSq11vu66rf90/cZr47" crossorigin="anonymous">
{#    <link rel="stylesheet" href="{{ url_for('static', filename='js/menus-min.js') }}">#}
    <link rel="stylesheet" href="{{ url_for('static', filename='css/layouts/side-menu.css') }}">

        <!--[if lte IE 8]>
            <link rel="stylesheet" href="css/layouts/side-menu-old-ie.css">
        <![endif]-->
        <!--[if gt IE 8]><!-->
{#            <link rel="stylesheet" href="css/layouts/side-menu.css">#}

        <!--<![endif]-->
<style>
.dropdown {
  position: relative;
  display: inline-block;
}
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  padding: 12px 16px;
}
.dropdown:hover .dropdown-content {
  display: block;
}
</style>

</head>
<body>

<div id="layout">
   <!-- Menu toggle -->
    <a href="#menu" id="menuLink" class="menu-link">
        <!-- Hamburger icon -->
        <span></span>
    </a>

    <div style="width: 200px">
        <div id = "menu" style="overflow: unset">
        <div class="pure-menu">
            <a href="/" class="pure-menu-heading">KsherPay APIs</a>
            <div class="pure-menu custom-restricted-width">
                <ul class="pure-menu-list">
                <li class="pure-menu-item">
                <li class="pure-menu-item pure-menu-has-children">
                    <a href="#" id="menuLink1" class="pure-menu-link" aria-haspopup="true">ðŸ”–Order Request</a>
                    <ul class="pure-menu-children">
                        <li class="pure-menu-item">
                            <a href="/native_pay" class="pure-menu-link">Ksher Native_Pay API ðŸ”—</a>
                        </li>
                        <li class="pure-menu-item">
                            <a href="/quick_pay" class="pure-menu-link">Ksher Quick_Pay API ðŸ”—</a>
                        </li>
                        <li class="pure-menu-item">
                            <a href="/jsapi_pay" class="pure-menu-link">Ksher Jsapi_Pay API ðŸ”—</a>
                        </li>
                        <li class="pure-menu-item">
                            <a href="/web_alipay" class="pure-menu-link">Ksher Web_Alipay API ðŸ”—</a>
                        </li>
                        <li class="pure-menu-item">
                            <a href="/wap_alipay" class="pure-menu-link">Ksher Wap_Alipay API ðŸ”—</a>
                        </li>
                        <li class="pure-menu-item">
                            <a href="/app_pay" class="pure-menu-link">Ksher APP_Pay API ðŸ”—</a>
                        </li>
                        <li class="pure-menu-item">
                            <a href="/minipro_pay" class="pure-menu-link">Ksher Miniprogram_Pay API ðŸ”—</a>
                        </li>
                    </ul>
                </li>
                <li class="pure-menu-item"><a href="/order_query" class="pure-menu-link">Order Query</a></li>
                <li class="pure-menu-item"><a href="/order_close" class="pure-menu-link">Order Close</a></li>
                <li class="pure-menu-item"><a href="/order_refund" class="pure-menu-link">Order Refund</a></li>
                <li class="pure-menu-item"><a href="/refund_query" class="pure-menu-link">Refund Query</a></li>
                <li class="pure-menu-item"><a href="/rate_query" class="pure-menu-link">Rate Query</a></li>
                <li class="pure-menu-item"><a href="pay_notify" class="pure-menu-link">Pay Notify</a></li>
                <li class="pure-menu-item"><a href="/error_codes" class="pure-menu-link">ERROR CODES</a></li>


            </ul>
            </div>

        </div>
    </div>
    </div>










    <div id = "main" >
        <div class="header">
            <h3>Ksher Refund Query API Documentation</h3>

        </div>

        <div class="content">

            <h3>Ksher Refund Query Request url</h3>
            <p> https://api.mch.ksher.net/KsherPay/refund_query  </p>
            <h3> Request Method</h3>
            <p> Post </p>
            <h3>Request Format</h3>
            <p>application/x-www-form-urlencoded</p>
            <h3>Ksher Refund Query Request</h3>

            <h4>- Request Parameters</h4>
            <table class="pure-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Value Example</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pure-table-odd">
                        <td>appid</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>mch20163  </td>
                        <td>appid is the merchant ID that authorised by Ksher</td>
                    </tr>

                    <tr>
                        <td>nonce_str</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>"sQ8gfSpeeV5Ld8ulW9q7JxUnXSOiZ90Y"</td>
                        <td>Random string</td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>channel</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>wechat</td>
                        <td>Value range: wechat /alipay</td>
                    </tr>

                    <tr>
                        <td>sign</td>
                        <td>String(256)</td>
                        <td>YES</td>
                        <td> </td>
                        <td>refer to following relevant chapter for signature algorithm</td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>mch_order_no</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td> </td>
                        <td>generated by merchant self, it must be unique on the merchant side.</td>
                    </tr>

                    <tr>
                        <td>ksher_order_no </td>
                        <td>String(32) </td>
                        <td>YES</td>
                        <td> </td>
                        <td>Order no. generated by Ksher. </td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>channel_order_no </td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td></td>
                        <td>Order no. generated by payment channel(wechat, alipay etc.) Note: Not all these three parameters(mch_order_no, ksher_order_no, channel_order_no) are needed to provide at one time, but at least one should be provided.  </td>
                    </tr>

                     <tr>
                        <td>time_stamp</td>
                        <td>String(256)</td>
                        <td>YES</td>
                        <td> </td>
                        <td> time stamp example: "time_stamp": "20190622131804"</td>
                    </tr>

                   <tr class="pure-table-odd">
                        <td>version</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>"3.0.0"</td>
                        <td>API version</td>
                    </tr>



                </tbody>
            </table>

            <h4>-Request Example</h4>

            <code class="rainbow">

                <div>{</div>
                    <div>"appid": "mch20163",</div>
                    <div>"channel": "wechat",</div>
                    <div> "fee_type": "THB",  </div>
                    <div>"ksher_order_no": "",  </div>
                    <div>"mch_order_no": "1495773587",</div>
                    <div> "nonce_str": "IeYrVB93dq8JbJbHJq1oZAW4d7PEb4jU",  </div>
                    <div>"sign": "14bc865f1d360210ef9b7551304faa905f2240e1f7eca2ddaadcdc1287cda90f3149dac8aab7163084be4fdf56fe12bdc95ae87a6b4187b94e4118e435f0db23",</div>
                    <div>"time_stamp": "20170516125822",  </div>
                    <div>"version": "3.0.0"</div>
                <div>}</div>
            </code>


            <h4>-SUCCESS Response Parameters</h4>

            <table class="pure-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Value Example</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pure-table-odd">
                        <td>code</td>
                        <td>int</td>
                        <td>YES</td>
                        <td>0</td>
                        <td>0: it only shows the calling of the API is successful, not meaning the target business operation succeed. Non 0: Calling of the API failed, merchant can use the same parameters to launch the request again.</td>
                    </tr>

                    <tr>
                        <td>sign</td>
                        <td>String(256)</td>
                        <td>YES</td>
                        <td></td>
                        <td>refer to following relevant chapter for signature algorithm</td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>msg</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td> </td>
                        <td>the response message.</td>
                    </tr>

                    <tr>
                        <td>status_code</td>
                        <td>int</td>
                        <td>YES</td>
                        <td></td>
                        <td>0: it only shows the calling of the API is successful, not meaning the target business operation succeed. Non 0: Calling of the API failed, merchant can use the same parameters to launch the request again.</td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>status_msg</td>
                        <td>String(256)</td>
                        <td>NO</td>
                        <td> </td>
                        <td>the status message </td>
                    </tr>

                    <tr>
                        <td>time_stamp</td>
                        <td>String(256)</td>
                        <td>YES</td>
                        <td>"20190622131804"</td>
                        <td>time stamp </td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>version</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>"3.0.0"</td>
                        <td>API version</td>
                    </tr>

                    <tr>
                        <td>data</td>
                        <td>JSON</td>
                        <td>YES</td>
                        <td></td>
                        <td>refer to data params below</td>
                    </tr>


                </tbody>
            </table>

            <h4>data Parameters</h4>
            <table class="pure-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Value Example</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pure-table-odd">
                        <td>cash_fee </td>
                        <td>int </td>
                        <td>YES</td>
                        <td>CNY </td>
                        <td>specifies the total cash payment amount of a transaction.  </td>
                    </tr>

                    <tr>
                        <td>cash_fee_type</td>
                        <td>string(16)  </td>
                        <td>YES</td>
                        <td>CNY</td>
                        <td>comply with ISO 4217 </td>
                    </tr>


                    <tr class="pure-table-odd">
                        <td>channel_order_no </td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td></td>
                        <td>Order no. generated by payment channel(wechat, alipay etc.) Note: Not all these three parameters(mch_order_no, ksher_order_no, channel_order_no) are needed to provide at one time, but at least one should be provided.  </td>
                    </tr>
                    <tr>
                        <td>channel_state</td>
                        <td>string(16)</td>
                        <td>YES</td>
                        <td>SUCCESS</td>
                        <td></td>
                        <td>the response state from e-wallet</td>

                    </tr>

                     <tr class="pure-table-odd">
                        <td>fee_type</td>
                        <td>String(16)</td>
                        <td>YES</td>
                        <td>CNY</td>
                        <td>comply with ISO 4217, 3 characters </td>
                    </tr>

                    <tr>
                        <td>ksher_order_no</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td></td>
                        <td>generated by Ksher</td>
                    </tr>

                     <tr  class="pure-table-odd">
                        <td>mch_order_no</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td> </td>
                        <td>generated by merchant self, it must be unique on the merchant side.</td>
                    </tr>

                    <tr>
                        <td>nonce_str</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>"sQ8gfSpeeV5Ld8ulW9q7JxUnXSOiZ90Y"</td>
                        <td>Random string</td>
                    </tr>

                    <tr  class="pure-table-odd">
                        <td>refund_count </td>
                        <td>int </td>
                        <td>YES </td>
                        <td></td>
                        <td>Total times of refund for this order. </td>
                    </tr>

                    <tr>
                        <td>refund_orders </td>
                        <td>Dict array </td>
                        <td>YES </td>
                        <td></td>
                        <td>See below for the detailed structure of this dict. </td>
                    </tr>


                </tbody>
            </table>
            <h4>data Parameters</h4>
            <table class="pure-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Value Example</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pure-table-odd">
                        <td>ksher_refund_no</td>
                        <td>String(32) </td>
                        <td>YES </td>
                        <td></td>
                        <td>generated by Ksher, each refund no. can be used once only. </td>
                    </tr>



                     <tr>
                        <td>mch_refund_no </td>
                        <td>String(32)</td>
                        <td>YES </td>
                        <td></td>
                        <td>generated by merchant self, each refund no. can be used once only. </td>

                    </tr>

                    <tr class="pure-table-odd">
                        <td>channel_refund_no</td>
                        <td>String(32) </td>
                        <td>YES </td>
                        <td></td>
                        <td>generated by channel(wechat), each refund no. can be used once only. </td>
                    </tr>

                    <tr>
                        <td>mch_refund_fee</td>
                        <td>int</td>
                        <td>YES </td>
                        <td></td>
                        <td>Refund amount </td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>refund_time </td>
                        <td>String(14)</td>
                        <td>YES </td>
                        <td></td>
                        <td>When the refund was made. </td>

                    </tr>

                    <tr>
                        <td>refund_state </td>
                        <td>String(32) </td>
                        <td>YES </td>
                        <td>SUCCESS </td>
                        <td>
                            <div>
                                <p>refund statusï¼š</p>
                                <p> REFUNDSUCCESSâ€”succeeded to refund,</p>
                                <p> FAILâ€”failed to refund,</p>
                                <p>PROCESSINGâ€”the refund application is being processed,</p>
                                <p> NOTSUREâ€”not sure(merchant needs to submit refund application again with the same refund no.), </p>
                                <p>CHANGEâ€”change to the merchant paying(the bank card of the consumer is already unavailable or frozen, which lead to the failure of refunding back into the bank card and funds flew back to the cash account, in this case, merchant needs to refund consumer offline or through transfer )</p>
                            </div>
                        </td>
                    </tr>

                </tbody>
            </table>



            <h4>-SUCCESS Response example</h4>
            <code class="rainbow">
                <div>{</div>
                    <div>"code": 0,</div>
                    <div>"data":</div>
                        <div> "cash_fee": "0",</div>
                        <div> "cash_fee_type": "",   </div>
                        <div>"channel_order_no": "4001432001201705161046458587",  </div>
                        <div>"channel_state": "SUCCESS",  </div>
                        <div>"fee_type": "THB",  </div>
                        <div>"ksher_order_no": "60020170516111039687364",  </div>
                        <div> "mch_order_no": "1494904236",  </div>
                        <div> "nonce_str": "ogWfy5jDlujCyhJCKNjYQVlrSGkdj9LO",  </div>
                        <div>"refund_count": "1",  </div>
                        <div>"refund_fee": "10", </div>
                        <div>"refund_orders": [ </div>
                        <div> { </div>
                        <div> "channel_refund_no": "2001432001201705161067277299",  </div>
                        <div> "ksher_refund_no": "60020170516111642859666",  </div>
                        <div> "mch_refund_fee": 10, </div>
                        <div> "mch_refund_no": "refund1494904599",  </div>
                        <div> "refund_state": "REFUNDSUCCESS", </div>
                        <div> "refund_time": "2017-05-16 10:16:43"</div>
                        <div>  } </div>
                        <div>  ],  </div>
                        <div> "result": "SUCCESS",  </div>
                        <div> "time_end": "2017-05-16 10:11:05",  </div>
                        <div>"total_fee": 10 </div>
                        <div>    }, </div>
                        <div>"msg": "ok",  </div>
                        <div> "sign": "0518d8e5659928a4c645ba1e9ade09d16f521079c3d99485aed9260868ab893f7c62f7c7f3bf1086f39d7dedb0ed53ba3a3a2ff0a70f86246c6c40aa4065949b",  </div>
                        <div>"status_code": "",  </div>
                        <div> "status_msg": "", </div>
                        <div>"time_stamp": "", </div>
                        <div>"version": "2.0.0" </div>
                        <div>} </div>
            </code>



            <h4>-FAIL Response Parameters</h4>
            <table class="pure-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Value Example</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pure-table-odd">
                        <td>code</td>
                        <td>int</td>
                        <td>YES</td>
                        <td>0</td>
                        <td>0: it only shows the calling of the API is successful, not meaning the target business operation succeed. Non 0: Calling of the API failed, merchant can use the same parameters to launch the request again.</td>
                    </tr>

                    <tr>
                        <td>sign</td>
                        <td>String(256)</td>
                        <td>YES</td>
                        <td></td>
                        <td>refer to following relevant chapter for signature algorithm</td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>msg</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td> </td>
                        <td>the response message.</td>
                    </tr>

                    <tr>
                        <td>status_code</td>
                        <td>int</td>
                        <td>YES</td>
                        <td></td>
                        <td>0: it only shows the calling of the API is successful, not meaning the target business operation succeed. Non 0: Calling of the API failed, merchant can use the same parameters to launch the request again.</td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>status_msg</td>
                        <td>String(256)</td>
                        <td>NO</td>
                        <td> </td>
                        <td>the status message </td>
                    </tr>

                    <tr>
                        <td>time_stamp</td>
                        <td>String(256)</td>
                        <td>YES</td>
                        <td>"20190622131804"</td>
                        <td>time stamp </td>
                    </tr>

                    <tr class="pure-table-odd" >
                        <td>version</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>"3.0.0"</td>
                        <td>API version</td>
                    </tr>

                    <tr>
                        <td>data</td>
                        <td>JSON</td>
                        <td>YES</td>
                        <td></td>
                        <td>refer to data params below</td>
                    </tr>


                </tbody>
            </table>

            <h4>data Parameters</h4>
            <table class="pure-table">
                <thead>
                    <tr>
                        <th>Parameter</th>
                        <th>Type</th>
                        <th>Required</th>
                        <th>Value Example</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="pure-table-odd">
                        <td>result</td>
                        <td>string(16)</td>
                        <td>YES</td>
                        <td>FAIL</td>
                        <td>Value range: FAIL, NOTSURE .FAIL : failed to close,in this case, merchant should re-launch the close request. NOTSURE: it is not sure if the close operation succeed. </td>
                    </tr>

                    <tr>
                        <td>nonce_str</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>"sQ8gfSpeeV5Ld8ulW9q7JxUnXSOiZ90Y"</td>
                        <td>Random string</td>
                    </tr>

                    <tr class="pure-table-odd">
                        <td>err_code</td>
                        <td>String(32)</td>
                        <td>YES</td>
                        <td>SYSTEMERROR</td>
                        <td>Refer to the error list for the details</td>
                    </tr>

                    <tr>
                        <td>err_msg</td>
                        <td>String(128)</td>
                        <td>YES</td>
                        <td>system error</td>
                        <td>the detailed description of the error</td>
                    </tr>


                </tbody>
            </table>

            <h4>-FAIL response example</h4>
            <div>{</div>
                <div>"code": 0,</div>
                <div>"status_code": "",</div>
                <div>"status_msg": "",</div>
                <div>"sign": '02635a1a60cfcaf461c6b860ac7ffd967c98c19803ddc4b698d2279502451f837d225fe38810357dc5e50c9de114bb40ad3513dd972f2e7db8ff08a09240c604',</div>
                <div>"version": "3.0.0",</div>
                <div>"msg": "ok",</div>
                <div>"time_stamp": "",</div>
                <div> "data":</div>
                <div>{"result": "FAIL",</div>
                <div>"err_code": "KSHER_INVALID_MCHINFO",</div>
                <div>"err_msg": "merchant not exist.",</div>
                <div>"nonce_str": ''}</div>
                <div>}</div>


        </div>

        <div class = "footer">
            <div class="pure-u-1-3">

            </div>


        </div>

    </div>
</div>

{#<script src="static/js/ui.js"></script>#}
{#<script src="{{ url_for('static', filename='js/ui.js') }}"></script>#}
<script>
  (function (window, document) {
    'use strict'

    // Enable drop-down menus in Pure
    // Inspired by YUI3 gallery-simple-menu by Julien LeComte
    // [https://github.com/yui/yui3-gallery/blob/master/src/gallery-simple-menu/js/simple-menu.js]

    function PureDropdown (dropdownParent) {

      var PREFIX = 'pure-',
        ACTIVE_CLASS_NAME = PREFIX + 'menu-active',
        ARIA_ROLE = 'role',
        ARIA_HIDDEN = 'aria-hidden',
        MENU_OPEN = 0,
        MENU_CLOSED = 1,
        MENU_PARENT_CLASS_NAME = 'pure-menu-has-children',
        MENU_ACTIVE_SELECTOR = '.pure-menu-active',
        MENU_LINK_SELECTOR = '.pure-menu-link',
        MENU_SELECTOR = '.pure-menu-children',
        DISMISS_EVENT = (window.hasOwnProperty &&
          window.hasOwnProperty('ontouchstart')) ?
          'touchstart' : 'mousedown',

        ARROW_KEYS_ENABLED = true,

        ddm = this // drop down menu

      this._state = MENU_CLOSED

      this.show = function () {
        if (this._state !== MENU_OPEN) {
          this._dropdownParent.classList.add(ACTIVE_CLASS_NAME)
          this._menu.setAttribute(ARIA_HIDDEN, false)
          this._state = MENU_OPEN
        }
      }

      this.hide = function () {
        if (this._state !== MENU_CLOSED) {
          this._dropdownParent.classList.remove(ACTIVE_CLASS_NAME)
          this._menu.setAttribute(ARIA_HIDDEN, true)
          this._link.focus()
          this._state = MENU_CLOSED
        }
      }

      this.toggle = function () {
        this[this._state === MENU_CLOSED ? 'show' : 'hide']()
      }

      this.halt = function (e) {
        e.stopPropagation()
        e.preventDefault()
      }

      this._dropdownParent = dropdownParent
      this._link = this._dropdownParent.querySelector(MENU_LINK_SELECTOR)
      this._menu = this._dropdownParent.querySelector(MENU_SELECTOR)
      this._firstMenuLink = this._menu.querySelector(MENU_LINK_SELECTOR)

      // Set ARIA attributes
      this._link.setAttribute('aria-haspopup', 'true')
      this._menu.setAttribute(ARIA_ROLE, 'menu')
      this._menu.setAttribute('aria-labelledby', this._link.getAttribute('id'))
      this._menu.setAttribute('aria-hidden', 'true');
      [].forEach.call(
        this._menu.querySelectorAll('li'),
        function (el) {
          el.setAttribute(ARIA_ROLE, 'presentation')
        }
      );
      [].forEach.call(
        this._menu.querySelectorAll('a'),
        function (el) {
          el.setAttribute(ARIA_ROLE, 'menuitem')
        }
      )

      // Toggle on click
      this._link.addEventListener('click', function (e) {
        e.stopPropagation()
        e.preventDefault()
        ddm.toggle()
      })

      // Keyboard navigation
      document.addEventListener('keydown', function (e) {
        var currentLink,
          previousSibling,
          nextSibling,
          previousLink,
          nextLink

        // if the menu isn't active, ignore
        if (ddm._state !== MENU_OPEN) {
          return
        }

        // if the menu is the parent of an open, active submenu, ignore
        if (ddm._menu.querySelector(MENU_ACTIVE_SELECTOR)) {
          return
        }

        currentLink = ddm._menu.querySelector(':focus')

        // Dismiss an open menu on ESC
        if (e.keyCode === 27) {
          /* Esc */
          ddm.halt(e)
          ddm.hide()
        }
        // Go to the next link on down arrow
        else if (ARROW_KEYS_ENABLED && e.keyCode === 40) {
          /* Down arrow */
          ddm.halt(e)
          // get the nextSibling (an LI) of the current link's LI
          nextSibling = (currentLink) ? currentLink.parentNode.nextSibling : null
          // if the nextSibling is a text node (not an element), go to the next one
          while (nextSibling && nextSibling.nodeType !== 1) {
            nextSibling = nextSibling.nextSibling
          }
          nextLink = (nextSibling) ? nextSibling.querySelector('.pure-menu-link') : null
          // if there is no currently focused link, focus the first one
          if (!currentLink) {
            ddm._menu.querySelector('.pure-menu-link').focus()
          } else if (nextLink) {
            nextLink.focus()
          }
        }
        // Go to the previous link on up arrow
        else if (ARROW_KEYS_ENABLED && e.keyCode === 38) {
          /* Up arrow */
          ddm.halt(e)
          // get the currently focused link
          previousSibling = (currentLink) ? currentLink.parentNode.previousSibling : null
          while (previousSibling && previousSibling.nodeType !== 1) {
            previousSibling = previousSibling.previousSibling
          }
          previousLink = (previousSibling) ? previousSibling.querySelector('.pure-menu-link') : null
          // if there is no currently focused link, focus the last link
          if (!currentLink) {
            ddm._menu.querySelector('.pure-menu-item:last-child .pure-menu-link').focus()
          }
          // else if there is a previous item, go to the previous item
          else if (previousLink) {
            previousLink.focus()
          }
        }
      })

      // Dismiss an open menu on outside event
      document.addEventListener(DISMISS_EVENT, function (e) {
        var target = e.target
        if (target !== ddm._link && !ddm._menu.contains(target)) {
          ddm.hide()
          ddm._link.blur()
        }
      })

    }

    function initDropdowns () {
      var dropdownParents = document.querySelectorAll('.pure-menu-has-children')
      for (var i = 0; i < dropdownParents.length; i++) {
        var ddm = new PureDropdown(dropdownParents[i])
      }
    }

    initDropdowns()

  }(this, this.document))
</script>
</body>





